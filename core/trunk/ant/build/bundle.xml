<project name="griffon-bundle">

    <target name="jar" depends="build-test" description="Build the entire source, run all tests and create the griffon JAR file.">
        <delete>
            <fileset dir="${griffon.dist}" includes="*"/>
        </delete>
        <jar destfile="${griffon.dist}/griffon-cli-${griffon.version}.jar" manifest="${griffon.build.cli}/META-INF/MANIFEST.MF">
            <fileset dir="${griffon.build.cli}"/>
        </jar>
        <jar destfile="${griffon.dist}/griffon-rt-${griffon.version}.jar" manifest="${griffon.build.rt}/META-INF/MANIFEST.MF">
              <fileset dir="${griffon.build.rt}"/>
        </jar>
    </target>

    <target name="package-minimal" depends="clean,jar" description="Creates a minimal archive that can be used for integrating a griffon project with an existing build system.">
        <property name="archive" value="griffon-${griffon.version}-minimal"/>

         <!--The files to include in the minimal distribution. -->
        <patternset id="files.pkg.minimal">
            <include name="${griffon.dist}/*.jar"/>
            <include name="${griffon.lib}/*.jar"/>
            <include name="build.properties"/>
            <include name="bin/**/*"/>
            <include name="conf/**/*"/>
            <include name="scripts/**/*"/>
            <include name="src/griffon/templates/scaffolding/**/*"/>
        </patternset>

        <delete failonerror="true">
            <fileset dir="${griffon.dist}">
                <include name="*-minimal.zip"/>
                <include name="*-minimal.tar.gz"/>
            </fileset>
        </delete>

         <!--Create a ZIP distribution... -->
        <zip basedir="${basedir}" destfile="${griffon.dist}/${archive}.zip">
            <patternset refid="files.pkg.minimal"/>
        </zip>

         <!--... and a tarball one. -->
        <tar destfile="${griffon.dist}/${archive}.tar.gz" compression="gzip" longfile="gnu">
            <tarfileset dir="${basedir}">
                <patternset refid="files.pkg.minimal"/>
            </tarfileset>
        </tar>
    </target>

    <target name="package" depends="clean,test,jar,javadoc" description="Create the release archives for griffon.">
        <delete failonerror="true">
            <fileset dir="${griffon.dist}">
                <include name="*.zip"/>
                <include name="*.tar.gz"/>
            </fileset>
        </delete>
        <delete dir="tmp" failonerror="true"/>
        <antcall target="create-binary-release"/>
        <antcall target="create-source-release"/>
    </target>

    <target name="install" depends="clean,test,jar,javadoc" description="Installs the package into GRIFFON_HOME">
        <delete dir="tmp" failonerror="true"/>
        <antcall target="create-binary-release"/>
        <unzip src="${griffon.dist}/${griffon.dist.binary}.zip" dest="${env.GRIFFON_HOME}">
            <mapper type="regexp" from="griffon-${griffon.version}/(.*)" to="\1"/>
        </unzip>
    </target>

</project>